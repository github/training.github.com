{% if site.gauges_id %}
  <!-- Gauges (http://gaug.es/) -->
  <script type="text/javascript">
    var _gauges = _gauges || [];
    (function() {
      var t   = document.createElement('script');
      t.type  = 'text/javascript';
      t.async = true;
      t.id    = 'gauges-tracker';
      t.setAttribute('data-site-id', '{{ site.gauges_id }}');
      t.src = '//secure.gaug.es/track.js';
      var s = document.getElementsByTagName('script')[0];
      s.parentNode.insertBefore(t, s);
    })();
  </script>
{% endif %}

{% if site.google_analytics_id %}
  <!-- Google Analytics (http://google.com/analytics) -->
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', '{{ site.google_analytics_id }}']);
    _gaq.push(['_setDomainName', '{{ site.url }}']); // Multiple sub-domains
    _gaq.push(['_setAllowLinker', true]); // Multiple TLDs
    _gaq.push(['_trackPageview']);
    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>

<script type="text/javascript">
	var DemandbaseAnalytics=DemandbaseAnalytics||{};
	DemandbaseAnalytics.demandbaseGA={
		key:'cd3954907e7b8374c10ebd4f88b757a96541ff8b',
		fields:["company_name","audience","industry","revenue_range","watch_list_account_status"],
		dbDataSet: null,
		track:function(data) {
	      try {
	        data=DemandbaseAnalytics.demandbaseGA._flatA(data);
	        DemandbaseAnalytics.demandbaseGA.dbDataSet = data;  /*allows access to db dataset in JS outside of this namespace */
	        for(field in DemandbaseAnalytics.demandbaseGA.fields){
	        	var lbl=DemandbaseAnalytics.demandbaseGA._cA(DemandbaseAnalytics.demandbaseGA._toPC(DemandbaseAnalytics.demandbaseGA.fields[field]));
	        	var val=data[DemandbaseAnalytics.demandbaseGA.fields[field]]||'(not set)';
	        	DemandbaseAnalytics.demandbaseGA._var((parseInt(field)+1),lbl,val,1);
	        	DemandbaseAnalytics.demandbaseGA._logE(lbl + ' : ' + val);
	        }

	        if(data) {
	        	var cat=data['audience'] || '(not detected)';
				var act=data['audience_segment'] || '(not detected)';
				var lbl=data['company_name'] || '(not detected)';
				DemandbaseAnalytics.demandbaseGA._p('_trackEvent',cat,act,lbl,0,1);
				DemandbaseAnalytics.demandbaseGA._logE('Custom Event Tracked: '+cat+' : '+act+' : '+lbl);
				var cat=data['industry'] || '(not detected)';
				var act=data['sub_industry'] || '(not detected)';
				var lbl=data['company_name'] || '(not detected)';
				DemandbaseAnalytics.demandbaseGA._p('_trackEvent',cat,act,lbl,0,1);
				DemandbaseAnalytics.demandbaseGA._logE('Custom Event Tracked: '+cat+' : '+act+' : '+lbl);
				var cat=data['employee_range'] || '(not detected)';
				var act=data['revenue_range'] || '(not detected)';
				var lbl=data['company_name'] || '(not detected)';
				DemandbaseAnalytics.demandbaseGA._p('_trackEvent',cat,act,lbl,0,1);
				DemandbaseAnalytics.demandbaseGA._logE('Custom Event Tracked: '+cat+' : '+act+' : '+lbl);
	        }
	        DemandbaseAnalytics.demandbaseGA._event();
	      } catch(e){ DemandbaseAnalytics.demandbaseGA._logE('Integration Error: '+e)};
	    },
		load:function(){
			try {
				if(!window._gaq) window._gaq=[];
				var db=document.createElement('script');db.type='text/javascript'; db.async=true;
		        db.src=('https:'==document.location.protocol?'https://':'http://')+'api.demandbase.com/api/v2/ip.json?key='+this.key+'&callback=DemandbaseAnalytics.demandbaseGA.track&page='+document.URL+'&referrer='+document.referrer;
		        var s=document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(db,s);
		        _gaq.push(['_addDevId', 'NE7T9']);
		        DemandbaseAnalytics.demandbaseGA._logE('Loaded Script ' + db.src);
			} catch(e){ this._logE('Script Error: '+e)};
		},
		_cA:function(s){
			var al=['IP','SID','HQ','DMA','ISP'];
			for(a in al){
				s=s.replace(new RegExp(al[a],'ig'),al[a])}return s;
		},
		_flatA:function(a){
			for(d in a){
				if(typeof a[d]=='object'){
					for(cd in a[d]){a[d+'_'+cd]=a[d][cd]};
					delete a[d];
				}
			};
			return a;
		},
		_logE:function(m){ if(window['console'] !== 'undefined' && typeof(console) !== 'undefined') { console.log('DB GA '+m); } },
		_toPC:function(s){
			return s.replace(/_/g,' ').replace(/\w\S*/g,function(t){ return t.charAt(0).toUpperCase()+t.substr(1).toLowerCase() }); },
		_p:function(t,v1,v2,v3,v4,v5){ window._gaq.push([t,v1,v2,v3,v4,v5]); },
		_var:function(i,k,v,s){ this._p('_setCustomVar',i,k,v,s); },
		_event:function(){ this._p('_trackEvent','Demandbase','API Resolution','IP API',0,1); }
	};
	DemandbaseAnalytics.demandbaseGA.load();
</script>
{% endif %}
